<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.office.rebates.dal.dao.NewRebatesOrderMapper">
  <resultMap id="BaseResultMap" type="com.office.rebates.model.admin.RebatesOrderModel">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 31 10:57:09 CST 2015.
    -->
    <id column="order_id" jdbcType="BIGINT" property="orderId" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="sales_id" jdbcType="BIGINT" property="salesId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="soho3q_order_id" jdbcType="BIGINT" property="soho3qOrderId" />
    <result column="customer_mobile" jdbcType="VARCHAR" property="customerMobile" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="customer_company" jdbcType="VARCHAR" property="customerCompany" />
    <result column="customer_alipay" jdbcType="VARCHAR" property="customerAlipay" />
    <result column="porject_id" jdbcType="VARCHAR" property="porjectId" />
    <result column="porject_name" jdbcType="VARCHAR" property="porjectName" />
    <result column="checkin_date" jdbcType="DATE" property="checkinDate" />
    <result column="checkout_date" jdbcType="DATE" property="checkoutDate" />
    <result column="period_month" jdbcType="INTEGER" property="periodMonth" />
    <result column="period_week" jdbcType="INTEGER" property="periodWeek" />
    <result column="lease_amount" jdbcType="INTEGER" property="leaseAmount" />
    <result column="deposit_amount" jdbcType="INTEGER" property="depositAmount" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="last_update_time" jdbcType="TIMESTAMP" property="lastUpdateTime" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="bonus_after_tax" jdbcType="INTEGER" property="bonusAfterTax" />
    <result column="rebates_amount" jdbcType="INTEGER" property="rebatesAmount" />
  </resultMap>

  <select id="countOrderList" parameterType="java.util.Map" resultType="java.lang.Integer">
    SELECT count(*) FROM rebates.rebates_order ro
    left join rebates.rebates_user ru
    on ro.user_id = ru.user_id
    left join rebates.sales_people sp
    on ro.sales_id = sp.sales_id
    <trim prefix="WHERE" prefixOverrides="AND|OR">
      <if test="rebatesName != null and rebatesName != ''">
        ru.name = #{rebatesName}
      </if>
      <if test="salesName != null and salesName != ''">
        and sp.user_name = #{salesName}
      </if>
      <if test="customerName != null and customerName != ''">
        and ro.customer_name = #{customerName}
      </if>
      <if test="customerMobile != null and customerMobile != ''">
        and ro.customer_mobile = #{customerMobile}
      </if>
      <if test="soho3qOrderId != null and soho3qOrderId != ''">
        and ro.soho3q_order_id = #{soho3qOrderId}
      </if>
    </trim>
  </select>

  <select id="selectOrderList" parameterType="java.util.Map" resultMap="BaseResultMap">
    SELECT ro.order_id,ro.user_id,ro.sales_id,ro.soho3q_order_id,ro.customer_mobile,ro.customer_name,ro.customer_company,
    ro.customer_alipay,ro.porject_name,ro.checkin_date,ro.checkout_date,ro.period_month,ro.period_week,ro.lease_amount,
    ro.deposit_amount,ro.create_time,ro.last_update_time,ru.name,sp.user_name,rb.status,rb.bonus_after_tax,rb.rebates_amount
    FROM rebates.rebates_order ro
    left join rebates.rebates_user ru
    on ro.user_id = ru.user_id
    left join rebates.sales_people sp
    on ro.sales_id = sp.sales_id
    left join rebates.rebates_bonus rb
    ON ro.order_id = rb.order_id
    <trim prefix="WHERE" prefixOverrides="AND|OR">
      <if test="rebatesName != null and rebatesName != ''">
        ru.name = #{rebatesName}
      </if>
      <if test="salesName != null and salesName != ''">
        and sp.user_name = #{salesName}
      </if>
      <if test="customerName != null and customerName != ''">
        and ro.customer_name = #{customerName}
      </if>
      <if test="customerMobile != null and customerMobile != ''">
        and ro.customer_mobile = #{customerMobile}
      </if>
      <if test="soho3qOrderId != null and soho3qOrderId != ''">
        and ro.soho3q_order_id = #{soho3qOrderId}
      </if>
    </trim>
    order by ro.order_id DESC
    limit #{start},#{size}
  </select>

  <select id="selectOrderOne" parameterType="java.util.Map" resultMap="BaseResultMap">
    SELECT ro.order_id,ro.user_id,ro.sales_id,ro.soho3q_order_id,ro.customer_mobile,ro.customer_name,ro.customer_company,
    ro.customer_alipay,ro.porject_name,ro.checkin_date,ro.checkout_date,ro.period_month,ro.period_week,ro.lease_amount,
    ro.deposit_amount,ro.create_time,ro.last_update_time,ru.name,sp.user_name
    FROM rebates.rebates_order ro
    join rebates.rebates_user ru
    on ro.user_id = ru.user_id
    join rebates.sales_people sp
    on ro.sales_id = sp.sales_id
    where ro.order_id = #{orderId}
  </select>
  
  <select id="getMyOrderList" parameterType="java.util.Map" resultType="com.office.rebates.model.OrderModel">
    SELECT o.order_id as orderId, DATE_FORMAT(o.create_time,'%Y-%m-%d') as orderDate, b.soho3q_confirmed_order_num as soho3qOrderNum, 
    b.status as status, b.rebates_amount/100 as rebatesAmount
    from rebates_order o
    left outer join rebates_bonus b
    on o.order_id = b.order_id
    where o.user_id=#{userId,jdbcType=BIGINT}
    order by o.create_time desc
    limit #{start},#{size}
  </select>
  
</mapper>